- alias: Temperature Alert
  trigger:
    platform: numeric_state
    entity_id: sensor.temperature_158d00020ef39b
    value_template: '{{ state.state|round }}'
    above: 28.0
    # below: '30'
    # for:
    #   minutes: 1
  action:
    - service: notify.h5
      data_template:
        title: "温度提醒 {{ states.sensor.temperature_158d00020ef39b.state }}°C"
        message: ""

- alias: Humidity Alert
  trigger:
    platform: numeric_state
    entity_id: sensor.humidity_158d00020ef39b
    above: '80'
  action:
    - service: notify.h5
      data_template:
        title: "湿度提醒 {{ states.sensor.humidity_158d00020ef39b.state }}%"
        message: ""


- alias: Door Status
  trigger:
    platform: state
    entity_id: binary_sensor.door_window_sensor_158d0002025c4b
  action:
    - service: notify.h5
      data_template:
        title: "门"
        message: >
          {% if is_state('binary_sensor.door_window_sensor_158d0002025c4b', 'on') %}
            开
            {{now()}}
          {% else %}
            关
            {{now()}}
          {% endif %}


- alias: Remind Door
  trigger:
    platform: state
    entity_id: binary_sensor.door_window_sensor_158d0002025c4b
    from: 'off'
    to: 'on'
    for:
      minutes: 1
  action:
    - service: notify.h5
      data_template:
        title: "记得关门哦 \n {{ now() }}"
        message: ""


- alias: Notify Move
  trigger:
    platform: state
    entity_id: binary_sensor.motion_sensor_158d0001f3d0bb
    from: 'off'
    to: 'on'
  condition:
    condition: state
    entity_id: device_tracker.youqingkuinote9
    state: "not_home"
  action:
    - service: notify.h5
      data_template:
        title: "检测到移动 \n {{ now() }}"


- alias: motion detector
  trigger:
    platform: mqtt
    topic: myhome/dafang/motion
    payload: 'ON'
  condition:
    condition: or
    conditions:
    - condition: time
      after: '00:00:00'
      before: '07:00:00'
    - condition: state
      entity_id: device_tracker.youqingkuinote9
      state: "not_home"
  action:
  - service: script.record_video
  - service: notify.h5
    data_template:
      title: "dafang移动 \n {{ now() }}"
      message: ""

- alias: motion detector snapshot
  trigger:
    platform: mqtt
    topic: myhome/dafang/motion
    payload: 'ON'
  condition:
    condition: or
    conditions:
    - condition: time
      after: '00:00:00'
      before: '07:00:00'
    - condition: state
      entity_id: device_tracker.youqingkuinote9
      state: "not_home"
  action:
  - service: script.dafang_snapshot2


- alias: Device online notify
  trigger:
    platform: event
    event_type: 'state_changed'
  condition:
    condition: and
    conditions:
    - condition: template
      value_template: "{% if 'device_tracker' in trigger.event.data.entity_id  %} true {% else %} false {% endif %}"
    - condition: template
      value_template: "{% if is_state_attr(trigger.event.data.entity_id, 'source_type', 'router')%} true {% else %} false {% endif %}"
  action:
  - service: notify.h5
    data_template:
      title: "Wi-Fi"
      message: "{{ state_attr(trigger.event.data.entity_id, 'friendly_name') }} now status {{ states(trigger.event.data.entity_id) }} \n{{now().hour}}"
      data:
        tag: "{{trigger.event.data.entity_id}}-{{states(trigger.event.data.entity_id)}}-{{now().day}}-{{now().hour}}"


- alias: minio notify
  trigger:
    platform: mqtt
    topic: minio
  condition:
    condition: template
    value_template: "{% if 'ObjectCreated' in trigger.payload_json.EventType %} true {% else %} false {% endif %}"
  action:
  - service: ifttt.trigger
    data_template:
      event: rich_notify
      value1: "{% if 'jpg' in  trigger.payload_json.Key %} dafang with image {% else %} dafang with video {% endif%}"
      value2: "https://minio.youqingkui.me/{{trigger.payload_json.Key}}"
      value3: "https://minio.youqingkui.me/{{trigger.payload_json.Key}}"


- alias: auto_light_night
  trigger:
    platform: time
    at: '23:00:00'
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: light.xiaomi_philips_smart_led_ball
      state: 'on'
  action:
    - service: script.light_warm_model


- alias: 23:45自动关灯
  trigger:
    platform: time
    at: '23:35:00'
  action:
  - service: light.turn_off
    entity_id: light.xiaomi_philips_smart_led_ball


- alias: eight_wake_up
  trigger:
    platform: time
    at: '07:50:00'
  action:
  - service: light.turn_on
    entity_id: light.xiaomi_philips_smart_led_ball
  - service: script.light_bridge_model
  # 5分钟后自动关灯
  - service: light.xiaomi_miio_set_delayed_turn_off
    data:
      entity_id: light.xiaomi_philips_smart_led_ball
      time_period: 5


- alias: toggle_led_ball
  trigger:
    platform: event
    event_type: click
    event_data:
      entity_id: binary_sensor.switch_158d0002108f19
      click_type: single
  action:
    service: light.toggle
    entity_id: light.xiaomi_philips_smart_led_ball


- alias: ready_sleep
  trigger:
    platform: event
    event_type: long_click_press
    event_data:
      entity_id: binary_sensor.switch_158d0002108f19
      click_type: single
  action:
    service: script.light_night_sleep


- alias: auto_open_air
  trigger:
    platform: time
    at: '18:00:00'
  condition:
    condition: state
    entity_id: fan.xiaomi_air_purifier_2s
    state: 'off'
  action:
    - service: script.open_air_auto_model


- alias: auto_sleep_model_air
  trigger:
    platform: time
    at: '23:30:00'
  condition:
    condition: state
    entity_id: fan.xiaomi_air_purifier_2s
    state: 'on'
  action:
   - service: script.air_silent_model


- alias: auto_close_air
  trigger:
    platform: time
    minutes: 30
    seconds: 00
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: device_tracker.rendandeiphone
      state: 'not_home'
    - condition: state
      entity_id: device_tracker.youqingkuinote9
      state: 'not_home'
    - condition: state
      entity_id: fan.xiaomi_air_purifier_2s
      state: 'on'
  action:
    - service: fan.turn_off
      entity_id: fan.xiaomi_air_purifier_2s


- alias: auto_close_airconditioning
  trigger:
    platform: time
    minutes: '/10'
    seconds: 00
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: device_tracker.rendandeiphone
      state: 'not_home'
    - condition: state
      entity_id: device_tracker.youqingkuinote9
      state: 'not_home'
    - condition: state
      entity_id: binary_sensor.airconditioning
      state: 'on'
  action:
    - service: script.close_airconditioning


- alias: Notify Airconditioning
  trigger:
    platform: state
    entity_id: binary_sensor.airconditioning
    from: 'off'
    to: 'on'
  action:
    - service: notify.h5
      data:
        title: "空调打开"
        message: ""


- alias: leave_close_light
  trigger:
    platform: time
    minutes: '/10'
    seconds: 00
  condition:
    condition: and
    conditions:
    - condition: state
      entity_id: device_tracker.rendandeiphone
      state: 'not_home'
    - condition: state
      entity_id: device_tracker.youqingkuinote9
      state: 'not_home'
    - condition: state
      entity_id: light.xiaomi_philips_smart_led_ball
      state: 'on'
  action:
    - service: light.turn_off
      entity_id: light.xiaomi_philips_smart_led_ball
    - service: notify.h5
      data:
        title: "灯球已经自动关闭"
        message: ""


- alias: auto_hours_test
  trigger:
    platform: time
    hours: '/1'
    minutes: 50
    seconds: 00
  action:
    - service: notify.h5
      data:
        title: "auto_hours_test"
        message: ""


- alias: Air_quality_alert
  trigger:
    platform: numeric_state
    entity_id: fan.xiaomi_air_purifier_2s
    value_template: '{{ state.attributes.aqi|round }}'
    above: 15.0
    # below: '30'
    # for:
    #   minutes: 1
  action:
    - service: script.now_air_quality


- alias: back_home_open_air
  # 3个手机中任意一台wifi连接,或者门打开
  trigger:
    - platform: state
      entity_id: device_tracker.youqingkuinote9
      from: 'not_home'
      to: 'home'
    - platform: state
      entity_id: device_tracker.youqingkui
      from: 'not_home'
      to: 'home'
    - platform: state
      entity_id: device_tracker.rendandeiphone
      from: 'not_home'
      to: 'home'
    - platform: state
      entity_id: binary_sensor.door_window_sensor_158d0002025c4b
      from: 'off'
      to: 'on'
  # 如果时间是18:30 - 23:30，并且灯球是关闭
  condition:
    condition: and
    conditions:
    - condition: time
      after: '18:30:00'
      before: '23:00:00'
    - condition: state
      entity_id: light.xiaomi_philips_smart_led_ball
      state: 'off'
  action:
    # 打开灯球明亮模式
    - service: script.light_bridge_model
    - condition: and
      conditions:
      - condition: state
        entity_id: fan.xiaomi_air_purifier_2s
        state: 'off'
    # 打开空气净化器
    - service: script.open_air_auto_model

- alias: open_door_action
  trigger:
    platform: event
    event_type: html5_notification.clicked
    event_data:
      action: open_door
  action:
    - service: script.open_door

- alias: air_status_change
  trigger:
    platform: state
    entity_id: sensor.air_test
  action:
    - service: script.airconditioning_status


- alias: button_toggle_light_ball
  trigger:
    platform: event
    event_type: xiaomi_aqara.click
    event_data:
      entity_id: binary_sensor.switch_158d0001eb6251
      click_type: single
  action:
    - service: light.toggle
      entity_id: light.xiaomi_philips_smart_led_ball


- alias: button_light_bridge_model
  trigger:
    platform: event
    event_type: xiaomi_aqara.click
    event_data:
      entity_id: binary_sensor.switch_158d0001eb6251
      click_type: double
  action:
    - service: script.light_bridge_model


- alias: button_light_warm_model
  trigger:
    platform: event
    event_type: xiaomi_aqara.click
    event_data:
      entity_id: binary_sensor.switch_158d0001eb6251
      click_type: double
  action:
    - service: script.light_warm_model

- alias: connec_wifi_open_door
  trigger:
    platform: state
    entity_id: device_tracker.youqingkuinote9
    from: 'not_home'
    to: 'home'
  action:
    - service: script.open_door
    - service: script.open_door_push




#- alias: button_toggle_light_ball
#  trigger:
#    platform: event
#    event_type: xiaomi_aqara.click
#    event_data:
#      entity_id: binary_sensor.switch_158d0001eb6251
#      click_type: single
#  action:
#    - service: light.toggle
#      entity_id: light.xiaomi_philips_smart_led_ball
#
#- alias: button_light_bridge_model
#  trigger:
#    platform: event
#    event_type: xiaomi_aqara.click
#    event_data:
#      entity_id: binary_sensor.switch_158d0001eb6251
#      click_type: double
#  action:
#    - service: script.light_bridge_model



#- alias: button_toggle_light_ball
#  trigger:
#    platform: event
#    event_type: xiaomi_aqara.click
#    event_data:
#      entity_id: binary_sensor.switch_158d0001eb6251
#      click_type: single
#  action:
#    - service: light.toggle
#      entity_id: light.xiaomi_philips_smart_led_ball
#
#- alias: button_light_bridge_model
#  trigger:
#    platform: event
#    event_type: xiaomi_aqara.click
#    event_data:
#      entity_id: binary_sensor.switch_158d0001eb6251
#      click_type: double
#  action:
#    - service: script.light_bridge_model


#- alias: button_light_warm_model
#  trigger:
#    platform: event
#    event_type: xiaomi_aqara.click
#    event_data:
#      entity_id: binary_sensor.switch_158d0001eb6251
#      click_type: double
#  action:
#    - service: script.light_warm_model


#- alias: Door Open
#  trigger:
#    platform: state
#    entity_id: binary_sensor.door_window_sensor_158d0002025c4b
#    from: 'off'
#    to: 'on'
#  action:
#    - service: ifttt.trigger
#      data:
#        event: Notify
#        value1: "外门打开"
#
#- alias: Door Close
#  trigger:
#    platform: state
#    entity_id: binary_sensor.door_window_sensor_158d0002025c4b
#    from: 'on'
#    to: 'off'
#  action:
#    - service: ifttt.trigger
#      data:
#        event: Notify
#        value1: "外门关闭"

#- alias: Door Open
#  trigger:
#    platform: state
#    entity_id: binary_sensor.door_window_sensor_158d0002025c4b
#    from: 'off'
#    to: 'on'
#  action:
#    - service: ifttt.trigger
#      data:
#        event: Notify
#        value1: "外门打开"
#
#- alias: Door Close
#  trigger:
#    platform: state
#    entity_id: binary_sensor.door_window_sensor_158d0002025c4b
#    from: 'on'
#    to: 'off'
#  action:
#    - service: ifttt.trigger
#      data:
#        event: Notify
#        value1: "外门关闭"

#### 下面暂时用不到注释可以后面参考

#- alias: Turn on the gateway light
#  trigger:
#    platform: event
#    event_type: click
#    event_data:
#      entity_id: binary_sensor.switch_158d0002108f19
#      click_type: double
#  action:
#    service: light.toggle
#    entity_id: light.gateway_light_7811dcb7a577
#
#- alias: Back Home
#  trigger:
#    platform: state
#    entity_id: device_tracker.youqingkui
#    from: 'not_home'
#    to: 'home'
#  condition:
#    condition: and
#    conditions:
#      - condition: time
#        after: '19:00:00'
#        before: '07:00:00'
#      - condition: numeric_state
#        entity_id: sensor.illumination_7811dcb7a577
#        below: 450
#  action:
#    - service: light.turn_on
#      entity_id: light.gateway_light_7811dcb7a577
#    - service: ifttt.trigger
#      data:
#        event: Notify
#        value1: "youqingkui go home"
#
#- alias: Door Open Ringtone
#  trigger:
#    platform: state
#    entity_id: binary_sensor.door_window_sensor_158d0002025c4b
#    from: 'off'
#    to: 'on'
#  condition:
#    condition: time
#    after: '19:00:00'
#    before: '07:00:00'
#  action:
#    - service: script.play_ringtone
#
#- alias: Auto Close Gateway Light
#  trigger:
#    platform: state
#    entity_id: light.gateway_light_7811dcb7a577
#    from: 'off'
#    to: 'on'
#    for:
#      minutes: 3
#  action:
#    - service: light.turn_off
#      entity_id: light.gateway_light_7811dcb7a577
#
#- alias: Open Night Light
#  trigger:
#    platform: state
#    entity_id: binary_sensor.motion_sensor_158d0001f3d0bb
#    from: 'off'
#    to: 'on'
#
#  condition:
#    condition: and
#    conditions:
#      - condition: time
#        after: '19:00:00'
#        before: '07:00:00'
#      - condition: numeric_state
#        entity_id: sensor.illumination_7811dcb7a577
#        below: 80
#
#  action:
#    - service: light.turn_on
#      entity_id: light.gateway_light_7811dcb7a577
#
#- alias: Multiple Move
#  trigger:
#    platform: state
#    entity_id: binary_sensor.motion_sensor_158d0001f3d0bb
#    to: 'on'
#  action:
#    - service: ifttt.trigger
#      data:
#        event: Notify
#        value1: "持续移动"
#
#- alias: Auto Restart RTSP
#  trigger:
#    platform: time
#    minutes: '/60'
#    seconds: 00
#  action:
#    - service: script.dafang_rtsp_restart
#    - service: ifttt.trigger
#      data_template:
#        event: Notify
#        value1: "自动重启RTSP"

#- alias: Auto dafang night on
#  trigger:
#    platform: numeric_state
#    entity_id: sensor.illumination_7811dcb7a577
#    below: 95
#  action:
#    - service: mqtt.publish
#      data:
#        topic: myhome/dafang/night_mode/set
#        payload: "ON"
#    - service: ifttt.trigger
#      data:
#        event: Notify
#        value1: "dafang night on"
#
#
#- alias: Auto dafang night off
#  trigger:
#    platform: numeric_state
#    entity_id: sensor.illumination_7811dcb7a577
#    above: 200
#  action:
#    - service: mqtt.publish
#      data:
#        topic: myhome/dafang/night_mode/set
#        payload: "OFF"
#    - service: ifttt.trigger
#      data:
#        event: Notify
#        value1: "dafang night off"

#- alias: Dafang motor
#  trigger:
#    platform: state
#    entity_id: device_tracker.youqingkui
#    to: 'not_home'


# - alias: Close Gateway Light
#   trigger:
#     platform: state
#     entity_id: binary_sensor.motion_sensor_158d0001f3d0bb
#     from: 'on'
#     to: 'off'
#     for:
#       minutes: 5
#   action:
#     - service: light.turn_off
#       entity_id: light.gateway_light_7811dcb7a577

#- action:
#  - data:
#      event: Notify
#      value1: "dangfang 检测到移动"
#    service: ifttt.trigger
#  alias: motion detector
#  condition: []
#  id: '9522507257594'
#  trigger:
#  - payload: 'ON'
#    platform: mqtt
#    topic: myhome/dafang/motion


# - alias: Device online notify
#   trigger:
#     platform: state
#     from: 'not_home'
#     to: 'home'
#   action:
#     - service: ifttt.trigger
#       data_template:
#         event: Notify
#         value1: "{{ states.entity_id }} go home"

# - alias: Device online notify
#   trigger:
#     platform: event
#     event_type: 'state_changed'
#   action:
#     - service: ifttt.trigger
#       data_template:
#         event: Notify3
#         value1: "{{ trigger.event.data }} state_changed"

#- alias: Play Music
#  trigger:
#    platform: event
#    event_type: click
#    event_data:
#      entity_id: binary_sensor.switch_158d0002108f19
#      click_type: double
#  action:
#    - platform: command_line
#      command: python /home/pi/.homeassistantustom_components/love_music.py START

# - alias: "Startup Notification"
#   trigger:
#     - platform: event
#       event_type: homeassistant_start
#   action:
#     - service: notify.notify
#       data:
#         title: ok123
#         message: ninini

# - alias: "Send message at lunch time"
#   trigger:
#     platform: time
#     hours: 10
#     minutes: 2
#     seconds: 0
#   action:
#     service: notify.notify
#     data:
#       message: '该吃午饭了'
#       title: '为了健康，请规律饮食！'

# - alias: "test device_tracker"
#   trigger:
#     platform: template
#     entity_id: device_tracker.huawei_p10
#     value_template: "{% if is('device_tracker.huawei_p10', 'home') %}true{% endif %}"

#   action:
#     - service: notify.app_push
#       data:
#         title: device_tracker
#         message: "home"


#- alias: "Startup Notification"
#  trigger:
#    - platform: state
#      entity_id: sensor.Temperature
#  action:
#    - service: notify.app_push
#      data:
#        title: ok123
#        message: "{{states.sensor.Temperature.state}} hours"
#        # message: "{{states.device_tracker.youqingkuimbp.attributes.latitude}} value"
#
#
#- alias: "xiaomi Notification"
#  trigger:
#    - platform: state
#      entity_id:
#        - device_tracker.youqingkuimbp
#        - device_tracker.youqingdeiPhone
#  action:
#    - service: notify.sns_email
#      data:
#        target: arn:aws:sns:ap-northeast-2:887438777172:Home_Assistant
#        title: ok123
#        # message: "{{trigger.entity_id}} {{states.device_tracker.youqingkuimbp}} value"
#        message: "{{trigger.entity_id}} {{trigger.entity_id.state}} value"
#
#
#- alias: "Temperature Notification"
#  trigger:
#    - platform: state
#      entity_id:
#        - sensor.temperature_158d0001f538b8
#  action:
#    - service: ifttt.trigger
#      data:
#        event: Temperature
#        Value1: "{{states.sensor.temperature_158d0001f538b8.state}} push"
#    - service: notify.app_push
#      data:
#        title: "Temperature Notification"
#        message: "{{states.sensor.temperature_158d0001f538b8.state}} push"
#
#- alias: "Move Notification"
#  trigger:
#    - platform: state
#      entity_id:
#        - binary_sensor.motion_sensor_158d0001ae8149
#  action:
#    - service: ifttt.trigger
#      data:
#        event: Move
#        Value1: "{{ states.binary_sensor.motion_sensor_158d0001ae8149.to_state.state }} move"
#
#    - service: notify.app_push
#      data:
#        title: "Move Notification"
#        message: "{{states.binary_sensor.motion_sensor_158d0001ae8149.state}} push"


# - alias: If there is motion and its dark turn on the gateway light
#   trigger:
#     platform: state
#     entity_id: binary_sensor.motion_sensor_158d0001ae8149
#     from: 'off'
#     to: 'on'

#   action:
#     - service: light.turn_on
#       entity_id: light.gateway_light_7811dc64ea36
#       data:
#         brightness: 5


